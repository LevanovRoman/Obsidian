Семафоры представляют еще одно средство синхронизации для доступа к ресурсу. В Java семафоры представлены классом Semaphore, который располагается в пакете java.util.concurrent.

Для управления доступом к ресурсу семафор использует счетчик, представляющий количество разрешений. Если значение счетчика больше нуля, то поток получает доступ к ресурсу, при этом счетчик уменьшается на единицу. После окончания работы с ресурсом поток освобождает семафор, и счетчик увеличивается на единицу. Если же счетчик равен нулю, то поток блокируется и ждет, пока не получит разрешение от семафора.

Установить количество разрешений для доступа к ресурсу можно с помощью конструкторов класса Semaphore:

|            |                                                                                    |
| ---------- | ---------------------------------------------------------------------------------- |
| 1<br><br>2 | `Semaphore(``int` `permits)`<br><br>`Semaphore(``int` `permits,` `boolean` `fair)` |

Параметр `permits` указывает на количество допустимых разрешений для доступа к ресурсу. Параметр `fair` во втором конструкторе позволяет установить очередность получения доступа. Если он равен `true`, то разрешения будут предоставляться ожидающим потокам в том порядке, в каком они запрашивали доступ. Если же он равен `false`, то разрешения будут предоставляться в неопределенном порядке.

Для получения разрешения у семафора надо вызвать метод acquire(), который имеет две формы:

|   |   |
|---|---|
|1<br><br>2|`void` `acquire()` `throws` `InterruptedException`<br><br>`void` `acquire(``int` `permits)` `throws` `InterruptedException`|

Для получения одного разрешения применяется первый вариант, а для получения нескольких разрешений - второй вариант.

После вызова этого метода пока поток не получит разрешение, он блокируется.

После окончания работы с ресурсом полученное ранее разрешение надо освободить с помощью метода release():

|   |   |
|---|---|
|1<br><br>2|`void` `release()`<br><br>`void` `release(``int` `permits)`|

Первый вариант метода освобождает одно разрешение, а второй вариант - количество разрешений, указанных в permits. release() всегда используется в блоке finally.

Семафоры отлично подходят для решения задач, где надо ограничивать доступ. Например, классическая задача про обедающих философов. Ее суть: есть несколько философов, допустим, пять, но одновременно за столом могут сидеть не более двух. И надо, чтобы все философы пообедали, но при этом не возникло взаимоблокировки философами друг друга в борьбе за тарелку и вилку

``Пример с двумя телефонными будками:``

public class SemaphoreEx {  
    public static void main(String[] args) {  
        Semaphore callBox = new Semaphore(2); 
  
        new Person("Nikita", callBox);  
        new Person("Oleg", callBox);  
        new Person("Elena", callBox);  
        new Person("Victor", callBox);  
        new Person("Marina", callBox);  
    }  
}  
  
class Person extends Thread{  
    String name;  
    private Semaphore callBox;  
  
    public Person(String name, Semaphore callBox){  
        this.name = name;  
        this.callBox =callBox;  
        this.start();  
    }  
  
    public void run(){  
        try {  
            System.out.println(name + " ждет...");  
            callBox.acquire(); //метод для попытки получения разрешения                                       у семафора.  
                                // заблокирует поток пока ресурс не                                            станет доступным.            
            System.out.println(name + "пользуется телефоном");  
            sleep(2000);  
            System.out.println(name + "завершил звонок");  
        } catch (InterruptedException e) {  
            throw new RuntimeException(e);  
        }  
        finally {  
            callBox.release(); // освобождаем разрешения семафора.                                       всегда используется в блоке finally.  
        }  
    }  
}
